{"version":3,"sources":["../../js/Director.js"],"names":["Director","dataStore","getInstance","speed","minTop","window","innerHeight","maxTop","top","Math","random","get","push","i","y","birdsY","time","birds","land","pencils","birdsHeight","isGameOver","birdsBorder","left","birdsX","bottom","right","birdsWidth","length","pencil","pencilBorder","x","height","width","isStrike","console","log","check","draw","shift","innerWidth","createPencil","forEach","value","index","timer","requestAnimationFrame","run","put","cancelAnimationFrame","destroy","instance","bird","flag"],"mappings":"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","file":"Director.js","sourcesContent":["import {DataStore} from \"./base/DataStore.js\";\r\nimport {UpPencil} from \"./runtime/UpPencil.js\";\r\nimport {DownPencil} from \"./runtime/DownPencil.js\";\r\n\r\nexport class Director{\r\n    constructor(){\r\n        this.dataStore = DataStore.getInstance();\r\n        this.speed = 2;\r\n    }\r\n\r\n    static getInstance(){\r\n        if(!Director.instance){\r\n            Director.instance = new Director();\r\n        }\r\n        return Director.instance;\r\n    }\r\n\r\n    createPencil(){\r\n        const minTop = DataStore.getInstance().canvas.height/8;\r\n        const maxTop = DataStore.getInstance().canvas.height/2;\r\n        const top = minTop + Math.random()*(maxTop - minTop);\r\n\r\n        this.dataStore.get('pencils').push(new UpPencil(top));\r\n        this.dataStore.get('pencils').push(new DownPencil(top));\r\n\r\n    }\r\n\r\n    birdsEvent(){\r\n        for(let i = 0;i<=2;i++){\r\n            this.dataStore.get('birds').y[i] = this.dataStore.get('birds').birdsY[i];\r\n        }\r\n        this.dataStore.get('birds').time = 0;\r\n    }\r\n\r\n    /**\r\n     * 判断小鸟是否撞击铅笔\r\n     * @param bird\r\n     * @param pencil\r\n     */\r\n    static isStrike(bird,pencil){\r\n        let flag = false;\r\n\r\n        console.log(bird.top+'/'+pencil.bottom,bird.bottom+'/'+pencil.top,\r\n            bird.right+'/'+pencil.left,bird.left+'/'+pencil.right,\r\n            );\r\n        console.log(bird.top>pencil.bottom\r\n            ,bird.bottom<pencil.top\r\n            ,bird.right>pencil.left\r\n            ,bird.left>pencil.right);\r\n        if(bird.top>pencil.bottom\r\n            ||bird.bottom<pencil.top\r\n            ||bird.right<pencil.left\r\n            ||bird.left>pencil.right){\r\n            console.log('ok')\r\n            flag = true;\r\n        }\r\n        return !flag;\r\n    }\r\n\r\n    //判断小鸟是否撞击地板和铅笔\r\n    check(){\r\n        const birds = this.dataStore.get('birds');\r\n        const land   = this.dataStore.get('Land');\r\n        const pencils = this.dataStore.get('pencils');\r\n        if(birds.birdsY[0]+birds.birdsHeight[0]>=land.y){\r\n            this.isGameOver = true;\r\n            return;\r\n        }\r\n\r\n        //创建小鸟的边框模型\r\n        const birdsBorder = {\r\n            top:birds.y[0],\r\n            left:birds.birdsX[0],\r\n            bottom:birds.birdsY[0]+birds.birdsHeight[0],\r\n            right:birds.birdsX[0]+birds.birdsWidth[0]\r\n        };\r\n\r\n        let length = pencils.length;\r\n        for(let i=0;i<length;i++){\r\n\r\n            const pencil = pencils[i];\r\n            const pencilBorder = {\r\n                top:pencil.y,\r\n                left:pencil.x,\r\n                bottom:pencil.y+pencil.height,\r\n                right:pencil.x+pencil.width\r\n            };\r\n\r\n            if(Director.isStrike(birdsBorder,pencilBorder)){\r\n                console.log('啊！撞到铅笔了！');\r\n                // this.isGameOver = true;\r\n                return;\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n\r\n    run(){\r\n        this.check();\r\n        if(!this.isGameOver){\r\n            //绘制背景\r\n            this.dataStore.get('background').draw();\r\n\r\n            const pencils = this.dataStore.get('pencils');\r\n            if(pencils[0].x + pencils[0].width <= 0&&pencils.length===4){\r\n                pencils.shift();\r\n                pencils.shift();\r\n            }\r\n\r\n            if(pencils[0].x <= (DataStore.getInstance().canvas.width - pencils[0].width)/2&&pencils.length===2){\r\n                this.createPencil();\r\n            }\r\n\r\n            //绘制铅笔\r\n            this.dataStore.get('pencils').forEach(function(value,index){\r\n                value.draw();\r\n            });\r\n\r\n            //绘制草地\r\n            this.dataStore.get('Land').draw();\r\n\r\n            //绘制小鸟\r\n            this.dataStore.get('birds').draw();\r\n\r\n            let timer = requestAnimationFrame(()=>this.run());\r\n            this.dataStore.put('timer',timer);\r\n\r\n        }else{\r\n            cancelAnimationFrame(this.dataStore.get('timer'));\r\n            this.dataStore.destroy();\r\n        }\r\n\r\n    }\r\n}"]}